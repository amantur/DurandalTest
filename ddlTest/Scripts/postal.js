var postal=function(){"use strict";var b=[],g=[],e=0,k=m();function m(){var a=-1;if(navigator.appName==="Microsoft Internet Explorer"){var c=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(c)!==null)a=parseFloat(RegExp.$1)}return a}function l(d){var a=[],g=[],e,f,c,b;for(c in d)d.hasOwnProperty(c)&&a.push([c,d[c]]);a.sort();k>=6&&k<=8&&a.sort(function(a,b){e=Number(a[0]);if(isNaN(e))return 0;f=Number(b[0]);return isNaN(f)?0:e-f});for(b=0;b<a.length;b+=1)g[a[b][0]]=a[b][1];return g}function a(a){return a!==null&&typeof a!=="undefined"}function c(b){return!a(b)}function i(a){return typeof a!=="number"}function d(a){return typeof a!=="string"&&typeof a!=="number"}function h(a){return typeof a!=="object"&&typeof a!=="string"&&typeof a!=="number"}function j(a){return typeof a==="object"}function f(a){return typeof a!=="function"}function n(a){return typeof a!=="object"&&typeof a!=="function"}function p(f,g,b,d){var c,e;e=postal.notify(f,g,b);if(a(d)){c=window;if(j(b))c=b;d.call(c,e)}}function o(){var b,c,e,f,d;b=g.shift();if(a(b)){c=false;if(a(b.timeout)){e=(new Date).getTime();c=e-b.timestamp>b.timeout}if(!c){f=postal.notify(b.message,b.data,b.caller);if(a(b.oncomplete)){d=window;if(j(b.caller))d=b.caller;b.oncomplete.call(d,f)}}}}return{subscribe:function(e,g,k,m){var n,i;if(c(e))throw new Error("You must provide a message to subscribe to.");if(d(e))throw new Error("The message must be a string or a number.");if(c(g))throw new Error("You must provide a subscriber to the message.");if(h(g))throw new Error("The subscriber must be an object, a string or a number.");if(a(k)||a(g[e])){if(c(b[e]))b[e]=[];i=g[e+"Id"];if(c(i)){i=g.subscriberId;if(c(i))i=g}if(d(i))throw new Error("The id must be a number or a string.");if(c(k)){k=g[e];if(c(k))throw new Error("You must provide a callback to subscribe to the message.");}if(f(k))throw new Error("The callback must be a callable function.");if(c(m))m=g["_"+e];if(a(m)&&f(m))throw new Error("The blocker must be a callable function.");n=null;if(j(g))n=g;b[e][i]={callback:k,blocker:m,scope:n};b[e]=l(b[e])}else throw new Error("You must provide a callback to subscribe to the message.");},unsubscribe:function(g,f){var e,j,i;if(a(g)){if(d(g))throw new Error("The message must be a string or a number.");if(a(b[g]))if(a(f)){if(h(f))throw new Error("The subscriber must be an object, a string or a number.");e=f[g+"Id"];if(c(e)){e=f.subscriberId;if(c(e))e=f}if(d(e))throw new Error("The id must be a number or a string.");delete b[g][e];if(b[g].length===0)delete b[g]}else delete b[g]}else if(a(f)){if(h(f))throw new Error("The subscriber must be an object, a string or a number.");e=f.subscriberId;if(c(e))e=f;for(i in b)if(b.hasOwnProperty(i)){j=f[i+"Id"];if(a(j))e=j;if(d(e))throw new Error("The id must be a number or a string.");delete b[i][e];if(b[i].length===0)delete b[i]}}else throw new Error("You must provide a message or subscriber to unsubscribe.");},trigger:function(a){if(c(a))throw new Error("You must provide an options object to trigger.");if(c(a.method))throw new Error("You must provide a method to deliver the message.");switch(a.method){case"notify":return this.notify(a.message,a.data,a.caller);case"publish":this.publish(a.message,a.data,a.caller,a.delay,a.oncomplete);break;case"dispatch":this.dispatch(a.message,a.data,a.caller,a.timeout,a.oncomplete);break;default:throw new Error("The method provided does not exist.");}},notify:function(i,p,g){var o=[],e,f,m,h,l,j,k;if(c(i))throw new Error("You must provide a message to deliver.");if(d(i))throw new Error("The message must be a string or a number.");if(a(g)&&n(g))throw new Error("The caller must be an object or a function.");e=b[i];for(f in e)if(e.hasOwnProperty(f)){m=e[f].callback;h=e[f].blocker;l=e[f].scope||window;j=false;if(a(h))j=h.call(l,p,g);if(!j){k=m.call(l,p,g);a(k)&&o.push(k)}}return o},publish:function(d,g,e,b,c){if(a(b)){if(i(b))throw new Error("The delay must be a number.");}else b=500;if(a(c)&&f(c))throw new Error("The oncomplete callback must be a callable function.");window.setTimeout(function(){p(d,g,e,c)},b)},dispatch:function(h,k,j,c,b){var d;if(a(c)&&i(c))throw new Error("The timeout must be a number.");if(a(b)&&f(b))throw new Error("The oncomplete callback must be a callable function.");d=(new Date).getTime();g.push({message:h,data:k,caller:j,timestamp:d,timeout:c,oncomplete:b});e===0&&this.startPoll()},startPoll:function(b){if(a(b)){if(i(b))throw new Error("The interval must be a number.");}else b=1e3;e!==0&&this.stopPoll();e=window.setInterval(function(){o()},b)},stopPoll:function(){if(e>0){window.clearInterval(e);e=0;g=[]}},exists:function(e){if(c(e))throw new Error("You must provide a message to verify its existence.");if(d(e))throw new Error("The message must be a string or a number.");return a(b[e])},count:function(e){var g,f;if(c(e))throw new Error("You must provide a message to count its subscribers.");if(d(e))throw new Error("The message must be a string or a number.");g=0;for(f=0;f<b[e].length;f+=1)if(a(b[e][f]))g+=1;return g},reset:function(){b=[];g=[]}}}()